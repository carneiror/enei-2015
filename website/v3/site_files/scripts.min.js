(function ($, root, undefined) {
	
	$(function () {
		
		'use strict';

        /*-----------------------------------------------------------------------------------*/
        /*  Select Functions
        /*-----------------------------------------------------------------------------------*/ 

		$("<select />").appendTo("nav");

		$("<option />", {
			"selected": "selected",
			"value"   : "",
			"text"    : "Menu"
		}).appendTo("nav select");

		$(".navigation a").each(function() {

			var el = $(this),
				text = el.text(),
				selected = false;

			if (el.parent().parent().is('.sub-menu')) {
				text = '— ' + el.text();
			}

			if (el.parent().hasClass('current-menu-item')) {
				selected = true;
			}

			$("<option />", {
				"value"   : el.attr("href"),
				"text"    : text,
				"selected"	  : selected
			}).appendTo("nav select");				

		});

		$(".navigation select").change(function() {
		 	window.location = $(this).find("option:selected").val();
		});

		var nav = $('.navigation'),
			navHeight = $('.navigation > ul').height()+10;
		 
		$(window).on('scroll', function(){

			if($(window).scrollTop() > 175 ) {
				nav.addClass('fixed').height(navHeight);	
			} else {
				nav.removeClass('fixed').height('auto');	
			}

		});
		
        /*-----------------------------------------------------------------------------------*/
        /*  Countdown Functions
        /*-----------------------------------------------------------------------------------*/ 

		if ($("#countdown").length > 0) {

			enei_countdown();
			window.setInterval(function(){
				enei_countdown();
			}, 1000);

		}

		function enei_countdown() {

			var time = wp_vars.time,
				time = time.split(':'),
				date = wp_vars.date,
				date = date.split('/'),
				date = new Date(date[2], date[1]-1, date[0], time[0], time[1], '00'),
				timestamp = countdown(date, null, countdown.DAYS|countdown.HOURS|countdown.MINUTES|countdown.SECONDS),
				days = String(timestamp.days),
				hours = String(timestamp.hours),
				minutes = String(timestamp.minutes),
				seconds = String(timestamp.seconds);

			if (days.charAt(1) == '') {
				days = '0' + days;
			}

			if (hours.charAt(1) == '') {
				hours = '0' + hours;
			}

			if (minutes.charAt(1) == '') {
				minutes = '0' + minutes;
			}

			if (seconds.charAt(1) == '') {
				seconds = '0' + seconds;
			}

			$("#days-0").html(days.charAt(0));
			$("#days-1").html(days.charAt(1));
			$("#hours-0").html(hours.charAt(0));
			$("#hours-1").html(hours.charAt(1));
			$("#minutes-0").html(minutes.charAt(0));
			$("#minutes-1").html(minutes.charAt(1));
			$("#seconds-0").html(seconds.charAt(0));
			$("#seconds-1").html(seconds.charAt(1));

		}

        /*-----------------------------------------------------------------------------------*/
        /*  Item
        /*-----------------------------------------------------------------------------------*/ 

		var $container;
		if ($(".item").length > 0 && $("#schedule-temp").length == 0) {

			$(window).on('load', function(){
				if ($(".item-container").length == 0) {
					if ($("#how-to-get-here").length > 0 || $("#contacts").length > 0) {
						$.when(initializeMap(), itemSize()).done(
							$(".content-wrapper").css('opacity','1')
						);
					} else if ($("#prices").length > 0) {	
						$.when(itemSize()).done(
							resizePrices(),
							$(".content-wrapper").css('opacity','1')
						);
					} else if ($("#event").length > 0) {	
						$.when(itemSize()).done(
							resizeEvent(),
							$(".content-wrapper").css('opacity','1')
						);
					} else {
						$.when(itemSize()).done(
							$(".content-wrapper").css('opacity','1')
						);
					}
				}

				if ($(".single-eventos").length > 0) {
					$(".menu-item-61").addClass('current-menu-parent');
					$(".menu-item-62").addClass('current-menu-item');
				}	
			});

			$(window).on('resize', function(){
				if ($("#prices").length > 0) {	
					$.when(itemSize()).done(
						resizePrices()
					);
				} else if ($("#event").length > 0) {	
					$.when(itemSize()).done(
						resizeEvent()
					);
				} else {
					itemSize();
				}
			});

		} else {
			$(".content-wrapper").css('opacity','1');
		}

        /*-----------------------------------------------------------------------------------*/
        /*  Item Size Functions
        /*-----------------------------------------------------------------------------------*/ 

		function itemSize() {

			var previous,
				aux = 1;

			$(".item:not(.item-no-resize)").each(function( index ) {

				var height,
					width = Math.floor($(this).width()),
					gutter = 30,
					half_gutter = Math.floor(gutter/2),
					parent = 0;

				if ($('#info').length > 0 || $('#call-for-talks').length > 0 || $('#prices').length > 0) {

					if ($(window).width()<992 && $('#prices').length > 0) {
						height = 'auto';
					} else {
						if ($(this).hasClass('item-11')) {				
							if (aux % 2) {
								parent = aux+1;
							} else {
								parent = aux-1;	
							}
							height = Math.floor($('.item:nth-child(' + parent + ')').height());

							if ($(window).width()<768 && $('#info').length > 0) { 
								height = height/2;
							}

							if ($(window).width()<768 && $('#call-for-talks').length > 0 || $(window).width()<992 && $('#prices').length > 0) { 
								height = 'auto';
							}
						}
					}

				} else if ($("#schedule").length > 0) {	

					if ($(this).hasClass('item-xs')) {
						height = Math.floor($('.item-sm').height()/2);
					} else if ($(this).hasClass('item-sm')) {
						height = Math.floor($('.icons').height()/2)-gutter/2;
					} else if ($(this).hasClass('item-md')) {
						height = Math.floor($('.item-sm').height()*3/2);
					} else if ($(this).hasClass('item-lg')) {
						height = Math.floor($('.item-sm').height()*2);
					} else {
						if ($(window).width() > 991) {
							height = Math.floor($('.icons').width()*1);
						} else {
							height = Math.floor($('.icons').width()*3/2);
						}
					}

				} else if ($("#how-to-get-here").length > 0) {	

					if ($(this).hasClass('item-11')) {
						if ($(window).width()>768) { 
							height = Math.floor($(window).height()-150);
						} else {
							height = 'auto';
						}
					} else {
						height = Math.floor($(window).height()-150);
					}

				} else if ($("#contacts").length > 0) {

					if ($(this).hasClass('item-11')) {
						if ($(window).width()>768) { 
							height = Math.floor($(window).height()/2-gutter/2+100);
						} else {
							height = 'auto';
						}
					} else {
						if ($(window).width()>768) { 
							height = Math.floor($(window).height()+200);
						} else {
							height = Math.floor($(window).height()/2);
						}
					}

				}  else if ($("#dashboard").length > 0) {

					if ($(this).hasClass('item-12')) {
						if ($(window).width()>1140) { 
							height = (width/2)+gutter*2;	
						} else if ($(window).width()<768) { 
							height = 'auto';	
						} else {
							height = (width/2)+gutter*4;	
						}
					}

				} else if (!$("#event").length > 0) {

					if ($("#speakers").length > 0 && $(window).width() < 768) {
						if ($(this).hasClass('item-12')) {
							height = width + (width/2)+(gutter/2);
							height *= 2.25;
						} else if ($(this).hasClass('item-21')) {
							height = (width/2)+(gutter/2);
							height *= 2;
						}
					} else {

						if ($(this).hasClass('item-11') && (!$(this).hasClass('item-12'))) {
							height = width;	
						} else if ($(this).hasClass('item-12')) {
							height = width + (width/2)+(gutter/2);
						} else if ($(this).hasClass('item-21')) {
							height = (width/2)-(gutter/2);	
						}

					} 

				}

				if (height != 'auto') {
					height = Math.floor(height);
				}

				if ($('#speakers').length > 0) {
					$('.info').height($('.item-21:not(".open")').height()-4); //fix for item sizing when opened
				}

				if (height != 'auto' && (height == previous-1 || height == previous+1)) {
					height = previous;
				}
				
				if (height == 'auto') {
					$(this).css('height', 'auto !important');
				} else {
					$(this).height(height);
				}
				
				previous = height;
				aux++;

			});	

		}

        /*-----------------------------------------------------------------------------------*/
        /*  Google Maps Initialization
        /*-----------------------------------------------------------------------------------*/ 

		var map;

		function initializeMap() {

		    var styles = [{
		        "featureType": "road.highway",
		        "elementType": "geometry.fill",
		        "stylers": [{
		            "color": "#ffffff"
		        }]
		    }, {
		        "elementType": "labels.icon",
		        "stylers": [{
		            "visibility": "off"
		        }]
		    }, {
		        "featureType": "landscape",
		        "stylers": [{
		            "color": "#aaaaaa"
		        }]
		    }, {
		        "elementType": "labels.text.stroke",
		        "stylers": [{
		            "visibility": "off"
		        }]
		    }, {
		        "elementType": "labels.text.fill",
		        "stylers": [{
		            "color": "#808080"
		        }]
		    }, {
		        "featureType": "road.highway",
		        "elementType": "labels.text.fill",
		        "stylers": [{
		            "color": "#aaaaaa"
		        }]
		    }, {
		        "featureType": "poi",
		        "elementType": "labels",
		        "stylers": [{
		            "visibility": "on"
		        }]
		    }, {
		        "featureType": "water",
		        "stylers": [{
		            "color": "#27A5FF"
		        }]
		    }, {
		        "featureType": "poi.park",
		        "stylers": [{
		            "visibility": "off"
		        }]
		    }, {
		        "featureType": "poi.business",
		        "stylers": [{
		            "visibility": "off"
		        }]
		    }];

		    var eventLocation;
		    if ($("#contacts").length > 0) {
		    	eventLocation = wp_vars.contact_location;
		    } else if ($("#how-to-get-here").length > 0) {
		    	eventLocation = wp_vars.location;
		    }

		    var mapOptions = {
		        center: new google.maps.LatLng(eventLocation.lat, eventLocation.lng),
		        zoom: 16,
		        mapTypeId: google.maps.MapTypeId.ROADMAP,
		        styles: styles,
		        scrollwheel: false,
		        mapTypeControl: false,
		        panControl: false,
		        zoomControl: true,
		        zoomControlOptions: {
		            position: google.maps.ControlPosition.TOP_RIGHT,
		            style: google.maps.ZoomControlStyle.DEFAULT
		        }
		    };

		    var markerPos = new google.maps.LatLng(wp_vars.location.lat, wp_vars.location.lng);

		    map = new google.maps.Map(document.getElementById("map"), mapOptions);

		    var image = wp_vars.url + '/img/marker.png';
		    var marker = new google.maps.Marker({
		        position: markerPos,
		        map: map,
		        title: wp_vars.location.address,
		        icon: image
		    });

		}

        /*-----------------------------------------------------------------------------------*/
        /*  Directions Functions
        /*-----------------------------------------------------------------------------------*/ 

		$('#get-directions').on('click', function(){
			if ($("#how-to-get-here").length > 0 || $("#contacts").length > 0) {
				getDirections();
			}
		});

		function getDirections(){
			$("#instructions .spinner").show();
			var directionsService = new google.maps.DirectionsService();
			var directionsDisplay = new google.maps.DirectionsRenderer();

			if(navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(function(position) {
					var currentPos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);

					directionsDisplay.setMap(map);
					directionsDisplay.setPanel(document.getElementById('directions'));

					var request = {
						origin: currentPos, 
						destination: wp_vars.location.address,
						travelMode: google.maps.DirectionsTravelMode.DRIVING
					};

					directionsService.route(request, function(response, status) {
						if (status == google.maps.DirectionsStatus.OK) {
							$("#instructions .spinner").hide();
							$("#instructions").hide();
							$("#directions").show();
							directionsDisplay.setDirections(response);
						} else {
							$("#instructions .error").css('display','block');
						}
					});
				}, function() {
					handleNoGeolocation(true);
				});
			} else {
				// Browser doesn't support Geolocation
				handleNoGeolocation(false);
			}

			function handleNoGeolocation(errorFlag) {
				var error

				if (errorFlag) {
					error = 'Erro: O serviço de geolocalização falhou.';
				} else {
					error = 'Erro: O seu browser não suporta geolocalização.';
				}

				console.log(content);
			}
		}

        /*-----------------------------------------------------------------------------------*/
        /*  Schedule Functions
        /*-----------------------------------------------------------------------------------*/ 

		if ($("#schedule").length > 0) {

			$('.filter-cat').on('click', function(){
				var cat = $(this).attr('data-slug');

				$('.events .item').removeClass('item-hide');

				if (!$(this).hasClass('active')) {
					$('.filter-cat').removeClass('active');
					$(this).addClass('active');
					if (!(cat == 'todos')) {
						$('.events .item:not(.' + cat + ')').addClass('item-hide');
					}				
				}

			});

			var currentUrl = document.URL;
			$("#schedule .events a").on('click', function(e){
				e.preventDefault();
				console.log($(this).find('.inner .center-align').html());
				window.history.pushState({ path: $(this).attr('href') }, $(this).find('.inner .center-align').html(), $(this).attr('href'));
				$.ajax({
					url: $(this).attr('href'),
					success: function(data) {
						$('body').addClass('no-scroll');
						$('.md-event').addClass('md-show');
						$('.md-event .md-content').html($(data).find('#event'));
						resizeEvent();
					}
				});
			});

			$(".md-close").on('click', function(e){
				e.preventDefault();
				window.history.pushState({ path: currentUrl }, 'Calendário', currentUrl);
				$('body').removeClass('no-scroll');
				$('.md-event').removeClass('md-show');
			});

		}

        /*-----------------------------------------------------------------------------------*/
        /*  Isotope Functions
        /*-----------------------------------------------------------------------------------*/ 

		if ($(".item-container").length > 0) {
			var $container = $('.item-container');

			$container.isotope({
			  	itemSelector: '.item',
			  	layoutMode: 'packery'
			});

			$container.imagesLoaded( function() {
				$.when(itemSize()).done(
					$container.isotope(),
					$container.isotope( 'on', 'layoutComplete', function() {
					  	$(".content-wrapper").css('opacity','1')
					}),
					setTimeout(function(){ $(".content-wrapper").css('opacity','1'); }, 1000)
				);
			});
		}

        /*-----------------------------------------------------------------------------------*/
        /*  Speakers Functions
        /*-----------------------------------------------------------------------------------*/ 

		if ($("#speakers").length > 0) {

			if (window.location.hash) {
				openSpeaker($(window.location.hash));
			}

			$(".speaker a").click(function(e) {
			   e.stopPropagation();
			   window.open($(this).href());
			});

			$('.speaker').on('click', function(){
				openSpeaker($(this));
			});

		}

		function openSpeaker(speaker) {
			window.location.hash = speaker.attr('id');

			$('.speaker').not(speaker).removeClass('open item-12').find('.more').html('+');

			$(speaker).toggleClass('open item-12').find('.more').html('-');
			
			if (!$(speaker).hasClass('open')) {
				$(speaker).find('.more').html('+');
			} 

			console.log('clicou');

			itemSize();	

			if ($container) {
				$container.isotope();

				if ($(window).width() > 768) {
					window.scrollTo(0, $(speaker).offset().top-100);
				} else {
					window.scrollTo(0, $(speaker).offset().top-30);
				}			
			}
		}	

        /*-----------------------------------------------------------------------------------*/
        /*  Partners Functions
        /*-----------------------------------------------------------------------------------*/ 

		if ($("#partners").length > 0) {

			if (window.location.hash) {
				if ($(window.location.hash).length > 0) {
					if (!$(window.location.hash).hasClass('no-content')) {
						openPartner($(window.location.hash));
					}
				}
			}

			$(".partner a").click(function(e) {
			   e.stopPropagation();
			   window.open($(this).href());
			});

			$('.partner:not(.no-content)').on('click', function(){
				openPartner($(this));
			});

		}

		function openPartner(partner) {
			window.location.hash = partner.attr('id');

			$('.partner').not(partner).removeClass('open item-12').find('.more').html('+');
			$('.partner.item-mod').not(partner).removeClass('col-sm-6 col-md-4 item-mod').addClass('col-sm-3 col-md-2');


			$(partner).toggleClass('open item-12').find('.more').html('-');

			if (!$(partner).hasClass('col-sm-6 col-md-4') && !partner.hasClass('item-mod')) {
				$(partner).removeClass('col-sm-3 col-md-2').addClass('col-sm-6 col-md-4 item-mod');
			} else if (partner.hasClass('item-mod')) {
				$(partner).removeClass('col-sm-6 col-md-4 item-mod').addClass('col-sm-3 col-md-2');
			}
			
			if (!$(partner).hasClass('open')) {
				$(partner).find('.more').html('+');
				window.location.hash = '';
			} 

			itemSize();	

			if ($container) {
				$container.isotope();

				if ($(window).width() > 768) {
					window.scrollTo(0, $(partner).offset().top-100);
				} else {
					window.scrollTo(0, $(partner).offset().top-30);
				}			
			}
		}

        /*-----------------------------------------------------------------------------------*/
        /*  Price Tables Resize
        /*-----------------------------------------------------------------------------------*/ 

		function resizePrices() {
			if ($(".price-package").length) {
				var maxHeight = -1,
					listHeight = -1;

				$(".price-package").each(function( index ) {
					if($(this).height() > maxHeight) {
						maxHeight = $(this).height();
						listHeight = $(this).find('.list-group').height();	
					}
				});

				$(".price-package").each(function( index ) {
					if (maxHeight != $(this).height()) {
						$(this).addClass('price-package-small').height(maxHeight).find('.list-group').height(listHeight);
					}
				});
			}
		}

        /*-----------------------------------------------------------------------------------*/
        /*  Fill User Fields
        /*-----------------------------------------------------------------------------------*/ 

        if (wp_vars.firstname != '') {
        	$("#acf-field_54d654dad6a7a").val(wp_vars.firstname);
        }

        if (wp_vars.lastname != '') {
        	$("#acf-field_54d654efd6a7b").val(wp_vars.lastname);
        }
		
	});
	
})(jQuery, this);
